datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  userId    String         @id @unique
  username  String         @unique
  email     String         @unique
  password  String
  avatar    String?
  createdAt DateTime       @default(now())
  updatedAt DateTime       @default(now()) @updatedAt
  posts     Post[]         @relation("UserPosts")
  comments  Comment[]      @relation("UserComments")
  votes     Vote[]         @relation("UserVotes")
  votePages UserVotePage[] @relation("UserUserVotePages")
}

model Post {
  postId      String    @id @unique
  title       String
  description String
  status      Int       @default(1)
  createdBy   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @default(now()) @updatedAt
  category    String?
  votes       Vote[]    @relation("PostVotes")
  votePage    VotePage? @relation(fields: [votePageId], references: [votePageId])
  votePageId  String?
  user        User      @relation("UserPosts", fields: [createdBy], references: [userId])
}

model Vote {
  id         String    @id @default(uuid())
  postId     String
  userId     String
  votePageId String?
  voteType   Int // 0 for downvote, 1 for upvote
  post       Post      @relation("PostVotes", fields: [postId], references: [postId])
  user       User      @relation("UserVotes", fields: [userId], references: [userId])
  votePage   VotePage? @relation(fields: [votePageId], references: [votePageId])

  @@index([postId])
  @@index([userId])
  @@index([votePageId])
}

model Comment {
  commentId String   @id @unique
  createdBy String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  user      User     @relation("UserComments", fields: [createdBy], references: [userId])
}

model VotePage {
  votePageId String         @id @unique
  name       String
  userId     String
  users      UserVotePage[] @relation("VotePageUserVotePages")
  posts      Post[]
  votes      Vote[]
}

model UserVotePage {
  userId     String
  votePageId String
  user       User     @relation("UserUserVotePages", fields: [userId], references: [userId])
  votePage   VotePage @relation("VotePageUserVotePages", fields: [votePageId], references: [votePageId])

  @@id([userId, votePageId])
}
